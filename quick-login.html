<!DOCTYPE html>
<html>
<head>
    <title>Quick Login for Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; background: #2366a8; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #1d5a9a; }
        .status { margin: 20px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
        a { display: inline-block; margin: 10px; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; }
        a:hover { background: #218838; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quick Login for Debug</h1>
        
        <button onclick="setLibrarianUser()">Set Librarian User (User 21)</button>
        <button onclick="setAdminUser()">Set Admin User (User 1)</button>
        <button onclick="setDebugUser()">Set Debug User (User 25)</button>
        <button onclick="clearUser()">Clear User</button>
        
        <div class="status" id="status">No user set</div>
        
        <div>
            <a href="http://localhost:5173/loan-dashboard" target="_blank">Open Loan Dashboard</a>
            <a href="http://localhost:5173/debug-loans" target="_blank">Open Debug Test</a>
            <a href="http://localhost:5173/dashboard" target="_blank">Open Main Dashboard</a>
        </div>
        
        <h3>API Test</h3>
        <button onclick="testLoansAPI()">Test Loans API</button>
        <div id="api-result"></div>
    </div>

    <script>
        function setLibrarianUser() {
            const user = {
                user_id: 21,
                name: "Test Librarian",
                email: "librarian@test.com",
                role: "librarian"
            };
            localStorage.setItem('user', JSON.stringify(user));
            updateStatus();
        }

        function setAdminUser() {
            const user = {
                user_id: 1,
                name: "Admin",
                email: "admin@biblioteca.com",
                role: "admin"
            };
            localStorage.setItem('user', JSON.stringify(user));
            updateStatus();
        }

        function setDebugUser() {
            const user = {
                user_id: 25,
                name: "Debug Librarian",
                email: "debug@test.com",
                role: "librarian"
            };
            localStorage.setItem('user', JSON.stringify(user));
            updateStatus();
        }

        function clearUser() {
            localStorage.removeItem('user');
            updateStatus();
        }

        function updateStatus() {
            const user = localStorage.getItem('user');
            const statusDiv = document.getElementById('status');
            if (user) {
                const userData = JSON.parse(user);
                statusDiv.innerHTML = `<strong>Current User:</strong><br>
                    ID: ${userData.user_id}<br>
                    Name: ${userData.name}<br>
                    Email: ${userData.email}<br>
                    Role: ${userData.role}`;
                statusDiv.style.background = '#d4edda';
            } else {
                statusDiv.innerHTML = 'No user set';
                statusDiv.style.background = '#f8d7da';
            }
        }

        async function testLoansAPI() {
            const resultDiv = document.getElementById('api-result');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!user.user_id) {
                resultDiv.innerHTML = '<p style="color: red;">Please set a user first!</p>';
                return;
            }

            try {
                const response = await fetch('http://localhost:8000/api/loans', {
                    headers: {
                        'Content-Type': 'application/json',
                        'x-user-id': user.user_id.toString(),
                        'x-user-role': user.role
                    }
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<h4>Loans API Response:</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }

        // Initialize on load
        window.onload = updateStatus;
    </script>
</body>
</html>
